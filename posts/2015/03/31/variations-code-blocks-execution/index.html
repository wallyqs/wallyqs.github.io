<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Variations around the execution of code blocks &middot; Literate Infrastructure
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
                                 <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-55629836-1', 'auto');
    ga('send', 'pageview');

  </script>
    <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h2>
        <a href="/">
          Literate Infrastructure
        </a>
      </h2>
      <p>PaaS + Org mode</p>
      <p class="lead"><a href="https://twitter.com/wallyqs" target="_blank">@wallyqs</a></p>
    </div>

    <nav class="sidebar-nav">
      <a class="sidebar-nav-item" href="/">Home</a>

      
      
        
          
        
      
        
          
            <a class="sidebar-nav-item" href="/about.html">About</a>
          
        
      
        
      
        
          
        
      
        
          
            <a class="sidebar-nav-item" href="/posts/">Posts</a>
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      

    </nav>

    <p>&copy; 2015. All rights reserved.</p>
  </div>
</div>


    <div class="content container">
      <div class="post">
  <h1 class="post-title">Variations around the execution of code blocks</h1>
  <span class="post-date">31 Mar 2015</span>
  
<p>The following is an enumeration of the approach taken
  by systems or tools which in the end result in the execution of a code block
  by means of some configuration format, dsl, http request, cli tool, etc&#8230;</p>
<p>I decided to narrow down the list to the following for now:</p>
<table>
  <tr><td>Domain</td><td></td></tr>
  <tr><td></td><td></td></tr>
  <tr><td>Configuration Management</td><td>Chef, Puppet</td></tr>
  <tr><td>Infrastructure</td><td>Cloud Init, Packer, Terraform</td></tr>
  <tr><td>Workloads scheduling</td><td>Kubernetes, Marathon</td></tr>
</table>
<h1>Configuration Management</h1>
<h2>Chef</h2>
<ul>
  <li>Docs:
    <ul>
      <li><a href="https://docs.chef.io/resource_execute.html">https://docs.chef.io/resource_execute.html</a></li>
      <li><a href="https://docs.chef.io/resource_bash.html">https://docs.chef.io/resource_bash.html</a></li>
    </ul>
  </li>
</ul>
<p>Chef has some <i>resources</i> which help in the execution of code blocks.
  The configuration is driven by Ruby, which allows to not only having to rely</p>
<p>The following is based on the example found <a href="https://docs.chef.io/resource_execute.html">here</a>.  We have 2 code blocks
  in this case.  The first one creates a change in the server and the second one
  checks whether that code block has been executed in the past already,
  in order to make the resource <i>idempotent</i>.</p>
<div class="highlight"><pre><span class="sx">%w{rover fido bubbers}</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">pet_name</span><span class="o">|</span>
  <span class="n">execute</span> <span class="s2">&quot;feed_pet_</span><span class="si">#{</span><span class="n">pet_name</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">do</span>
    <span class="n">command</span> <span class="s2">&quot;echo &#39;Feeding: </span><span class="si">#{</span><span class="n">pet_name</span><span class="si">}</span><span class="s2">&#39;; touch &#39;/tmp/</span><span class="si">#{</span><span class="n">pet_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
    <span class="c1"># not_if { ::File.exists?(&quot;/tmp/#{pet_name}&quot;)}</span>
    <span class="n">not_if</span> <span class="s2">&quot;cat /tmp/</span><span class="si">#{</span><span class="n">pet_name</span><span class="si">}</span><span class="s2"> | grep Feeding&quot;</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
<h2>Puppet</h2>
<ul>
  <li>Docs:
    <ul>
      <li><a href="https://docs.puppetlabs.com/references/latest/type.html#exec">https://docs.puppetlabs.com/references/latest/type.html#exec</a></li>
    </ul>
  </li>
</ul>
<p>Puppet also tries to achieve idempotent runs of the code blocks.
  According to the docs:</p>
<blockquote>
  <p>There are three main ways for an exec to be idempotent:</p>
  <p>The command itself is already idempotent. (For example, <code>apt-get update</code>.)
    The exec has an <code>onlyif</code>, <code>unless</code>, or <code>creates attribute</code>, which prevents Puppet from running the command unless some condition is met.
    The exec has <code>refreshonly =&gt; true</code>, which only allows Puppet to run the command when some other resource is changed.</p>
</blockquote>
<p>Here the execution is driven via a specialized DSL (though Ruby inspired?)
  in order to make things declarative.</p>
<p>An example of its usage:</p>
<div class="highlight"><pre><span class="vg">$my_file_arg</span> <span class="o">=</span> <span class="s1">&#39;/tmp/myarg.txt&#39;</span>

<span class="n">file</span> <span class="p">{</span> <span class="vg">$my_file_arg</span><span class="p">:</span>
  <span class="n">content</span> <span class="o">=&gt;</span> <span class="s2">&quot;Hello now&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="nb">exec</span> <span class="p">{</span><span class="s2">&quot;Use $my_file_arg&quot;</span><span class="p">:</span>
  <span class="nb">require</span> <span class="o">=&gt;</span> <span class="no">File</span><span class="o">[</span><span class="vg">$my_file_arg</span><span class="o">]</span><span class="p">,</span>
  <span class="n">command</span> <span class="o">=&gt;</span> <span class="s2">&quot;/bin/sed -i s/Hello/Bye/g $my_file_arg&quot;</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
<p>Here we have 2 types of code blocks:</p>
<ul>
  <li>One expressing the contents of a file</li>
  <li>Another expressing the execution of a sed command</li>
</ul>
<h1>Infrastructure</h1>
<h2>Cloud Config and Cloud Init</h2>
<ul>
  <li>Docs:
    <ul>
      <li><a href="http://cloudinit.readthedocs.org/en/latest/topics/format.html#cloud-config-data">http://cloudinit.readthedocs.org/en/latest/topics/format.html#cloud-config-data</a></li>
      <li><a href="https://coreos.com/docs/cluster-management/setup/cloudinit-cloud-config/">https://coreos.com/docs/cluster-management/setup/cloudinit-cloud-config/</a></li>
      <li><a href="http://cloudinit.readthedocs.org/en/latest/topics/examples.html#yaml-examples">http://cloudinit.readthedocs.org/en/latest/topics/examples.html#yaml-examples</a></li>
    </ul>
  </li>
</ul>
<p>Cloud config is an interesting case.  Its execution is leveraged via <i>Convention Over Configuration</i> approach
  where anything under a certain path will be executed on the node.</p>
<p>The execution in this case is driven by <code>YAML</code> as in Kubernetes.</p>
<p>Here is an example of using <code>runcmd</code> (example taken from <a href="http://cloudinit.readthedocs.org/en/latest/topics/examples.html#yaml-examples">here</a>)</p>
<div class="highlight"><pre><span class="c1">#cloud-config</span>

<span class="c1"># run commands</span>
<span class="c1"># default: none</span>
<span class="c1"># runcmd contains a list of either lists or a string</span>
<span class="c1"># each item will be executed in order at rc.local like level with</span>
<span class="c1"># output to the console</span>
<span class="c1"># - if the item is a list, the items will be properly executed as if</span>
<span class="c1">#   passed to execve(3) (with the first arg as the command).</span>
<span class="c1"># - if the item is a string, it will be simply written to the file and</span>
<span class="c1">#   will be interpreted by &#39;sh&#39;</span>
<span class="c1">#</span>
<span class="c1"># Note, that the list has to be proper yaml, so you have to escape</span>
<span class="c1"># any characters yaml would eat (&#39;:&#39; can be problematic)</span>
<span class="l-Scalar-Plain">runcmd</span><span class="p-Indicator">:</span>
 <span class="p-Indicator">-</span> <span class="p-Indicator">[</span> <span class="nv">ls</span><span class="p-Indicator">,</span> <span class="nv">-l</span><span class="p-Indicator">,</span> <span class="nv">/</span> <span class="p-Indicator">]</span>
 <span class="p-Indicator">-</span> <span class="p-Indicator">[</span> <span class="nv">sh</span><span class="p-Indicator">,</span> <span class="nv">-xc</span><span class="p-Indicator">,</span> <span class="s">&quot;echo</span><span class="nv"> </span><span class="s">$(date)</span><span class="nv"> </span><span class="s">&#39;:</span><span class="nv"> </span><span class="s">hello</span><span class="nv"> </span><span class="s">world!&#39;&quot;</span> <span class="p-Indicator">]</span>
 <span class="p-Indicator">-</span> <span class="p-Indicator">[</span> <span class="nv">sh</span><span class="p-Indicator">,</span> <span class="nv">-c</span><span class="p-Indicator">,</span> <span class="nv">echo &quot;=========hello world&#39;=========&quot;</span> <span class="p-Indicator">]</span>
 <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">ls -l /root</span>
 <span class="p-Indicator">-</span> <span class="p-Indicator">[</span> <span class="nv">wget</span><span class="p-Indicator">,</span> <span class="s">&quot;http://slashdot.org&quot;</span><span class="p-Indicator">,</span> <span class="nv">-O</span><span class="p-Indicator">,</span> <span class="nv">/tmp/index.html</span> <span class="p-Indicator">]</span>
</pre></div>
<h2>Packer</h2>
<ul>
  <li>Documentation:
    <ul>
      <li><a href="https://www.packer.io/docs/command-line/build.html">https://www.packer.io/docs/command-line/build.html</a></li>
      <li><a href="https://www.packer.io/docs/provisioners/shell.html">https://www.packer.io/docs/provisioners/shell.html</a></li>
    </ul>
  </li>
</ul>
<p>Packer counts with a <code>shell provisioner</code>. A <i>provisioner</i> is a common theme in the tooling from Hashicorp.
  The description from the website notes:</p>
<blockquote>
  <p>The shell Packer provisioner provisions machines built by Packer using
    shell scripts. Shell provisioning is the easiest way to get software
    installed and configured on a machine.</p>
</blockquote>
<p>As an example, we can have <code>JSON</code> express what we want to do with the execution of the code block</p>
<div class="highlight"><pre><span class="p">{</span>
  <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;shell&quot;</span><span class="p">,</span>
  <span class="s2">&quot;inline&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;echo foo&quot;</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
<p>The execution of the remote resource then, is driven by the <code>JSON</code> format.
  Here is a more <a href="http://blog.endpoint.com/2014/03/provisioning-development-environment_14.html">complex example</a> I could find, one that invokes <code>Ansible</code>.</p>
<div class="highlight"><pre><span class="s2">&quot;provisioners&quot;</span><span class="o">:</span> <span class="p">[</span>
  <span class="p">{</span>
    <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;shell&quot;</span><span class="p">,</span>
    <span class="s2">&quot;inline&quot;</span><span class="o">:</span> <span class="p">[</span>
      <span class="s2">&quot;mkdir .ssh&quot;</span><span class="p">,</span>
      <span class="s2">&quot;echo &#39;{{user `public_key`}}&#39; &gt;&gt; .ssh/authorized_keys&quot;</span>
    <span class="p">]</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;shell&quot;</span><span class="p">,</span>
    <span class="s2">&quot;execute_command&quot;</span><span class="o">:</span> <span class="s2">&quot;echo &#39;{{user `ssh_pass`}}&#39; | {{ .Vars }} sudo -E -S sh &#39;{{ .Path }}&#39;&quot;</span><span class="p">,</span>
    <span class="s2">&quot;inline&quot;</span><span class="o">:</span> <span class="p">[</span>
      <span class="s2">&quot;add-apt-repository ppa:rquillo/ansible&quot;</span><span class="p">,</span>
      <span class="s2">&quot;apt-get update&quot;</span><span class="p">,</span>
      <span class="s2">&quot;apt-get install -y ansible&quot;</span><span class="p">,</span>
      <span class="s2">&quot;echo &#39;%sudo    ALL=(ALL)  NOPASSWD:ALL&#39; &gt;&gt; /etc/sudoers&quot;</span>
    <span class="p">]</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;ansible-local&quot;</span><span class="p">,</span>
    <span class="s2">&quot;playbook_file&quot;</span><span class="o">:</span> <span class="s2">&quot;site.yml&quot;</span>
  <span class="p">}</span>
<span class="p">]</span>
</pre></div>
<p>Here the provisioners are chained sequentially.
  One notable example is that we are now defining another sub code block named <code>execute_command</code>
  which is prepended to the execution of the original code block.</p>
<blockquote>
  <p>To many new users, the execute_command is puzzling. However, it provides an important function: customization of how the command is executed. The most common use case for this is dealing with sudo password prompts.</p>
</blockquote>
<h2>Terraform</h2>
<ul>
  <li>Docs:
    <ul>
      <li><a href="https://www.terraform.io/docs/provisioners/remote-exec.html">https://www.terraform.io/docs/provisioners/remote-exec.html</a></li>
    </ul>
  </li>
</ul>
<p>Terraform is an interesting case since it recognizes the limitations
  of using JSON and YAML to drive the execution of a provisioning run.</p>
<p>The following is an example of applying puppet, also taken from the docs.</p>
<div class="highlight"><pre># Run puppet and join our Consul cluster
resource &quot;aws_instance&quot; &quot;web&quot; {
    ...
    provisioner &quot;remote-exec&quot; {
        inline = [
        &quot;puppet apply&quot;,
        &quot;consul join ${aws_instance.web.private_ip}&quot;
        ]
    }
}
</pre></div>
<p>Here we are expressing that there is going to be a computing resource
  in AWS, and then when the resource is ready, the code block would be executed
  in that environment.</p>
<h1>Workloads scheduling</h1>
<h2>Kubernetes</h2>
<ul>
  <li>Docs:
    <ul>
      <li><a href="https://github.com/GoogleCloudPlatform/kubernetes/blob/master/examples/update-demo/nautilus-rc.yaml">https://github.com/GoogleCloudPlatform/kubernetes/blob/master/examples/update-demo/nautilus-rc.yaml</a></li>
    </ul>
  </li>
</ul>
<p>In the case of Kubernetes, the execution is driven via a YAML file.</p>
<p>A couple of examples below:</p>
<h4>Example: An Nginx service</h4>
<ul>
  <li>Explicitly say it is a <code>Service</code></li>
  <li>Describe the ports it will use</li>
  <li>Set a constraint about where to run the service</li>
</ul>
<div class="highlight"><pre><span class="l-Scalar-Plain">kind</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Service</span>
<span class="l-Scalar-Plain">apiVersion</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">v1beta1</span>
<span class="l-Scalar-Plain">id</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">nginx-example</span>
<span class="c1"># the port that this service should serve on</span>
<span class="l-Scalar-Plain">port</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">8000</span>
<span class="c1"># just like the selector in the replication controller,</span>
<span class="c1"># but this time it identifies the set of pods to load balance</span>
<span class="c1"># traffic to.</span>
<span class="l-Scalar-Plain">selector</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">nginx</span>
<span class="c1"># the container on each pod to connect to, can be a name</span>
<span class="c1"># (e.g. &#39;www&#39;) or a number (e.g. 80)</span>
<span class="l-Scalar-Plain">containerPort</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">80</span>
</pre></div>
<p>Not very clear what it is running, but it seems that
  an internal <code>containerport</code> will be exposed as the port 8000
  and that it will only be running in nodes tagged to be running <code>nginx</code> workloads.</p>
<p>The full example is <a href="https://github.com/GoogleCloudPlatform/kubernetes/commit/f1b55c04e2936fafb3c89d29dc474bb5b08f3673">here</a>.</p>
<h4>Example: A workload with a Healthcheck</h4>
<p>Here we have a container that has a <code>livenessProbe</code>,
  which can be done by either a command or a http request.</p>
<p>There are 2 code blocks: the <code>liveness-exec</code> which is going to be
  periodically writing <code>ok</code> into <code>/tmp/health</code> and its liveness probe,
  which is another code block that will be checking <code>cat /tmp/health</code></p>
<div class="highlight"><pre><span class="l-Scalar-Plain">apiVersion</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">v1beta1</span>
<span class="l-Scalar-Plain">desiredState</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">manifest</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">containers</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">image</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">busybox</span>
        <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">liveness</span>
        <span class="l-Scalar-Plain">livenessProbe</span><span class="p-Indicator">:</span>
          <span class="l-Scalar-Plain">exec</span><span class="p-Indicator">:</span>
            <span class="l-Scalar-Plain">command</span><span class="p-Indicator">:</span>
              <span class="p-Indicator">-</span> <span class="s">&quot;cat&quot;</span>
              <span class="p-Indicator">-</span> <span class="s">&quot;/tmp/health&quot;</span>
          <span class="l-Scalar-Plain">initialDelaySeconds</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">15</span>
        <span class="l-Scalar-Plain">command</span><span class="p-Indicator">:</span>
          <span class="p-Indicator">-</span> <span class="s">&quot;/bin/sh&quot;</span>
          <span class="p-Indicator">-</span> <span class="s">&quot;-c&quot;</span>
          <span class="p-Indicator">-</span> <span class="s">&quot;echo</span><span class="nv"> </span><span class="s">ok</span><span class="nv"> </span><span class="s">&gt;</span><span class="nv"> </span><span class="s">/tmp/health;</span><span class="nv"> </span><span class="s">sleep</span><span class="nv"> </span><span class="s">10;</span><span class="nv"> </span><span class="s">echo</span><span class="nv"> </span><span class="s">fail</span><span class="nv"> </span><span class="s">&gt;</span><span class="nv"> </span><span class="s">/tmp/health;</span><span class="nv"> </span><span class="s">sleep</span><span class="nv"> </span><span class="s">600&quot;</span>
    <span class="l-Scalar-Plain">id</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">liveness-exec</span>
    <span class="l-Scalar-Plain">version</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">v1beta1</span>
<span class="l-Scalar-Plain">id</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">liveness-exec</span>
<span class="l-Scalar-Plain">kind</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Pod</span>
<span class="l-Scalar-Plain">labels</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">test</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">liveness</span>
</pre></div>
<p>We can see some of the limitations already in deciding to use <code>YAML</code>
  for this since it looks unnatural that now a command has to be
  break apart and fit into an array structure by using YAML lists.</p>
<h2>Marathon</h2>
<ul>
  <li>Docs:
    <ul>
      <li><a href="https://github.com/mesosphere/marathon">https://github.com/mesosphere/marathon</a></li>
    </ul>
  </li>
</ul>
<p>In Marathon, scheduling of workloads is done via <code>JSON</code> payloads done to an HTTP API.</p>
<p>Here is <a href="https://github.com/mesosphere/marathon/blob/master/examples/bridge.json">an example</a> of starting a couple of code blocks,
  one which does a healthcheck and another one which is the job itself.</p>
<div class="highlight"><pre><span class="p">{</span>
  <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;bridged-webapp&quot;</span><span class="p">,</span>
  <span class="s2">&quot;cmd&quot;</span><span class="o">:</span> <span class="s2">&quot;python3 -m http.server 8080&quot;</span><span class="p">,</span>
  <span class="s2">&quot;cpus&quot;</span><span class="o">:</span> <span class="mf">0.25</span><span class="p">,</span>
  <span class="s2">&quot;mem&quot;</span><span class="o">:</span> <span class="mf">64.0</span><span class="p">,</span>
  <span class="s2">&quot;instances&quot;</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span>
  <span class="s2">&quot;container&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;DOCKER&quot;</span><span class="p">,</span>
    <span class="s2">&quot;docker&quot;</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;image&quot;</span><span class="o">:</span> <span class="s2">&quot;python:3&quot;</span><span class="p">,</span>
      <span class="s2">&quot;network&quot;</span><span class="o">:</span> <span class="s2">&quot;BRIDGE&quot;</span><span class="p">,</span>
      <span class="s2">&quot;portMappings&quot;</span><span class="o">:</span> <span class="p">[</span>
        <span class="p">{</span> <span class="s2">&quot;containerPort&quot;</span><span class="o">:</span> <span class="mi">8080</span><span class="p">,</span> <span class="s2">&quot;hostPort&quot;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;servicePort&quot;</span><span class="o">:</span> <span class="mi">9000</span><span class="p">,</span> <span class="s2">&quot;protocol&quot;</span><span class="o">:</span> <span class="s2">&quot;tcp&quot;</span> <span class="p">},</span>
        <span class="p">{</span> <span class="s2">&quot;containerPort&quot;</span><span class="o">:</span> <span class="mi">161</span><span class="p">,</span> <span class="s2">&quot;hostPort&quot;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;protocol&quot;</span><span class="o">:</span> <span class="s2">&quot;udp&quot;</span><span class="p">}</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="s2">&quot;healthChecks&quot;</span><span class="o">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="s2">&quot;protocol&quot;</span><span class="o">:</span> <span class="s2">&quot;HTTP&quot;</span><span class="p">,</span>
      <span class="s2">&quot;portIndex&quot;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="s2">&quot;path&quot;</span><span class="o">:</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span>
      <span class="s2">&quot;gracePeriodSeconds&quot;</span><span class="o">:</span> <span class="mi">5</span><span class="p">,</span>
      <span class="s2">&quot;intervalSeconds&quot;</span><span class="o">:</span> <span class="mi">20</span><span class="p">,</span>
      <span class="s2">&quot;maxConsecutiveFailures&quot;</span><span class="o">:</span> <span class="mi">3</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="s2">&quot;protocol&quot;</span><span class="o">:</span> <span class="s2">&quot;COMMAND&quot;</span><span class="p">,</span>
      <span class="s2">&quot;command&quot;</span><span class="o">:</span> <span class="p">{</span> <span class="s2">&quot;value&quot;</span><span class="o">:</span> <span class="s2">&quot;curl -f -X GET http://$HOST:$PORT&quot;</span> <span class="p">},</span>
      <span class="s2">&quot;gracePeriodSeconds&quot;</span><span class="o">:</span> <span class="mi">5</span><span class="p">,</span>
      <span class="s2">&quot;intervalSeconds&quot;</span><span class="o">:</span> <span class="mi">20</span><span class="p">,</span>
      <span class="s2">&quot;maxConsecutiveFailures&quot;</span><span class="o">:</span> <span class="mi">3</span>
    <span class="p">}</span>

  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
<p>Via the JSON configuration we are able to say transparently modify the execution of the code block and express
  that it should be done using a runtime which has <code>python:3</code> and a certain number of ports open.</p>
<p>For the healthcheck code block, it is defined the path and one liner that should be executed
  to consider that the other job is healthy or not.  It is also expressed that after 3 failures
  something would happen, though not expressed explicitly in the configuration.</p>
<h2>Thoughts</h2>
<p>Again, what I found interesting of all of these systems and tooling,
  is that they are variations around the same idea: wrap some configuration
  around the execution of a code block to transparently add some behavior
  to its execution.</p>
<p>Note: There are some technologies that I want to cover as well
  so I will be updating this post in the near future&#8230;</p>
<p>If you think I&#8217;m onto something you can follow me on <a href="https://twitter.com/wallyqs">Twitter</a>.</p>



</div>

<div class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/posts/2015/02/26/mesos-tokyo/">
            Talked at the Tokyo Mesos Meetup #1
            <small>26 Feb 2015</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/posts/2015/02/25/ob-mesos/">
            Running Org Babel workloads on top of Mesos with Go and the Docker Containerizer
            <small>25 Feb 2015</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/posts/2014/12/25/learning-go-backwards/">
            About type switch usage in Go
            <small>25 Dec 2014</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>

    </div>

  </body>
</html>
